{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/DevProjects/prospra/app/api/onboarding-progress/route.ts"],"sourcesContent":["// @ts-nocheck\r\nimport { NextResponse } from \"next/server\";\r\nimport { createServerClient } from \"@supabase/ssr\";\r\n\r\nconst FIELDS = [\r\n  \"name\",\r\n  \"industry\",\r\n  \"stage\",\r\n  \"website\",\r\n  \"audience\",\r\n  \"offer\",\r\n  \"goal90\",\r\n  \"challenge\",\r\n  \"onboarding_step\",\r\n];\r\n\r\nfunction createSupabaseServerClient(cookieHeader: string) {\r\n  return createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        get(name) {\r\n          const cookie = cookieHeader\r\n            .split(\";\")\r\n            .find((c) => c.trim().startsWith(name + \"=\"));\r\n          return cookie ? cookie.split(\"=\")[1] : null;\r\n        },\r\n        set() {},\r\n        remove() {},\r\n      },\r\n    }\r\n  );\r\n}\r\n\r\nexport async function GET(request: Request) {\r\n  try {\r\n    const cookieHeader = request.headers.get(\"cookie\") ?? \"\";\r\n    const supabase = createSupabaseServerClient(cookieHeader);\r\n\r\n    const {\r\n      data: { user },\r\n      error: userError,\r\n    } = await supabase.auth.getUser();\r\n\r\n    if (userError || !user) {\r\n      return NextResponse.json({ error: \"Not logged in\" }, { status: 401 });\r\n    }\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"profiles\")\r\n      .select(FIELDS.join(\",\"))\r\n      .eq(\"id\", user.id)\r\n      .single();\r\n\r\n    if (error) {\r\n      return NextResponse.json({ error: error.message }, { status: 400 });\r\n    }\r\n\r\n    return NextResponse.json(data ?? {}, { status: 200 });\r\n  } catch (err: any) {\r\n    console.error(\"Onboarding progress GET error:\", err);\r\n    return NextResponse.json(\r\n      { error: err.message ?? \"Unexpected server error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function PATCH(request: Request) {\r\n  try {\r\n    const cookieHeader = request.headers.get(\"cookie\") ?? \"\";\r\n    const body = await request.json();\r\n    const supabase = createSupabaseServerClient(cookieHeader);\r\n\r\n    const {\r\n      data: { user },\r\n      error: userError,\r\n    } = await supabase.auth.getUser();\r\n\r\n    if (userError || !user) {\r\n      return NextResponse.json({ error: \"Not logged in\" }, { status: 401 });\r\n    }\r\n\r\n    const updateData: any = {};\r\n    FIELDS.forEach((key) => {\r\n      if (body[key] !== undefined && body[key] !== null) {\r\n        updateData[key] = body[key];\r\n      }\r\n    });\r\n\r\n    const { error: updateError } = await supabase\r\n      .from(\"profiles\")\r\n      .update(updateData)\r\n      .eq(\"id\", user.id);\r\n\r\n    if (updateError) {\r\n      return NextResponse.json(\r\n        { error: updateError.message },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json({ ok: true }, { status: 200 });\r\n  } catch (err: any) {\r\n    console.error(\"Onboarding progress PATCH error:\", err);\r\n    return NextResponse.json(\r\n      { error: err.message ?? \"Unexpected server error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,cAAc;;;;;;;AACd;AACA;AAAA;;;AAEA,MAAM,SAAS;IACb;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAED,SAAS,2BAA2B,YAAoB;IACtD,OAAO,IAAA,iMAAkB,sUAGvB;QACE,SAAS;YACP,KAAI,IAAI;gBACN,MAAM,SAAS,aACZ,KAAK,CAAC,KACN,IAAI,CAAC,CAAC,IAAM,EAAE,IAAI,GAAG,UAAU,CAAC,OAAO;gBAC1C,OAAO,SAAS,OAAO,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG;YACzC;YACA,QAAO;YACP,WAAU;QACZ;IACF;AAEJ;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,GAAG,CAAC,aAAa;QACtD,MAAM,WAAW,2BAA2B;QAE5C,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACd,OAAO,SAAS,EACjB,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAE/B,IAAI,aAAa,CAAC,MAAM;YACtB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACrE;QAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,YACL,MAAM,CAAC,OAAO,IAAI,CAAC,MACnB,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;QAET,IAAI,OAAO;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,MAAM,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG;YAAE,QAAQ;QAAI;IACrD,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,IAAI,OAAO,IAAI;QAA0B,GAClD;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,MAAM,OAAgB;IAC1C,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,GAAG,CAAC,aAAa;QACtD,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,WAAW,2BAA2B;QAE5C,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACd,OAAO,SAAS,EACjB,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAE/B,IAAI,aAAa,CAAC,MAAM;YACtB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACrE;QAEA,MAAM,aAAkB,CAAC;QACzB,OAAO,OAAO,CAAC,CAAC;YACd,IAAI,IAAI,CAAC,IAAI,KAAK,aAAa,IAAI,CAAC,IAAI,KAAK,MAAM;gBACjD,UAAU,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI;YAC7B;QACF;QAEA,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAClC,IAAI,CAAC,YACL,MAAM,CAAC,YACP,EAAE,CAAC,MAAM,KAAK,EAAE;QAEnB,IAAI,aAAa;YACf,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,YAAY,OAAO;YAAC,GAC7B;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;QAAK,GAAG;YAAE,QAAQ;QAAI;IACvD,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,IAAI,OAAO,IAAI;QAA0B,GAClD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}