{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/DevProjects/prospra/lib/supabase/server.ts"],"sourcesContent":["import { cookies } from \"next/headers\";\nimport { createServerClient, type CookieOptions } from \"@supabase/ssr\";\n\nexport async function createClient() {\n  const cookieStore = await cookies();\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        get(name: string) {\n          // Cast to any so TypeScript stops complaining about .get\n          const store: any = cookieStore;\n          const cookie = store.get(name);\n          return cookie?.value;\n        },\n        set(_name: string, _value: string, _options: CookieOptions) {\n          // No-op in App Router server context – Supabase just needs this shape\n        },\n        remove(_name: string, _options: CookieOptions) {\n          // Same here – required by Supabase, safe to leave empty on the server\n        },\n      },\n    }\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAGvB;QACE,SAAS;YACP,KAAI,IAAY;gBACd,yDAAyD;gBACzD,MAAM,QAAa;gBACnB,MAAM,SAAS,MAAM,GAAG,CAAC;gBACzB,OAAO,QAAQ;YACjB;YACA,KAAI,KAAa,EAAE,MAAc,EAAE,QAAuB;YACxD,sEAAsE;YACxE;YACA,QAAO,KAAa,EAAE,QAAuB;YAC3C,sEAAsE;YACxE;QACF;IACF;AAEJ"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/DevProjects/prospra/app/api/credits/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\n\r\nexport async function GET() {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Auth check\r\n    const {\r\n      data: { user },\r\n    } = await supabase.auth.getUser();\r\n\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { used: 0, limit: 20, isPremium: false },\r\n        { status: 200 }\r\n      );\r\n    }\r\n\r\n    // Fetch profile for premium check\r\n    const { data: profile } = await supabase\r\n      .from(\"profiles\")\r\n      .select(\"is_premium, plan_tier, subscription_status\")\r\n      .eq(\"id\", user.id)\r\n      .single();\r\n\r\n    const isPremium =\r\n      profile?.is_premium ||\r\n      profile?.plan_tier === \"premium\" ||\r\n      profile?.subscription_status === \"active\";\r\n\r\n    // Premium users get unlimited credits\r\n    if (isPremium) {\r\n      return NextResponse.json(\r\n        { used: 0, limit: 9999, isPremium: true },\r\n        { status: 200 }\r\n      );\r\n    }\r\n\r\n    // Free user daily limit\r\n    const DAILY_LIMIT = 20;\r\n\r\n    // Get today's message count\r\n    const now = new Date();\r\n    const startOfDay = new Date(\r\n      now.getFullYear(),\r\n      now.getMonth(),\r\n      now.getDate()\r\n    ).toISOString();\r\n\r\n    const { count } = await supabase\r\n      .from(\"messages\")\r\n      .select(\"*\", { count: \"exact\", head: true })\r\n      .eq(\"role\", \"user\")\r\n      .eq(\"created_at\", `gte.${startOfDay}`)\r\n      .eq(\"user_id\", user.id);\r\n\r\n    return NextResponse.json(\r\n      {\r\n        used: count ?? 0,\r\n        limit: DAILY_LIMIT,\r\n        isPremium: false,\r\n      },\r\n      { status: 200 }\r\n    );\r\n  } catch (error) {\r\n    console.error(\"CREDITS API ERROR:\", error);\r\n    return NextResponse.json({ used: 0, limit: 20 }, { status: 200 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,2IAAY;QAEnC,aAAa;QACb,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAE/B,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,MAAM;gBAAG,OAAO;gBAAI,WAAW;YAAM,GACvC;gBAAE,QAAQ;YAAI;QAElB;QAEA,kCAAkC;QAClC,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,YACL,MAAM,CAAC,8CACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;QAET,MAAM,YACJ,SAAS,cACT,SAAS,cAAc,aACvB,SAAS,wBAAwB;QAEnC,sCAAsC;QACtC,IAAI,WAAW;YACb,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,MAAM;gBAAG,OAAO;gBAAM,WAAW;YAAK,GACxC;gBAAE,QAAQ;YAAI;QAElB;QAEA,wBAAwB;QACxB,MAAM,cAAc;QAEpB,4BAA4B;QAC5B,MAAM,MAAM,IAAI;QAChB,MAAM,aAAa,IAAI,KACrB,IAAI,WAAW,IACf,IAAI,QAAQ,IACZ,IAAI,OAAO,IACX,WAAW;QAEb,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SACrB,IAAI,CAAC,YACL,MAAM,CAAC,KAAK;YAAE,OAAO;YAAS,MAAM;QAAK,GACzC,EAAE,CAAC,QAAQ,QACX,EAAE,CAAC,cAAc,CAAC,IAAI,EAAE,YAAY,EACpC,EAAE,CAAC,WAAW,KAAK,EAAE;QAExB,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,MAAM,SAAS;YACf,OAAO;YACP,WAAW;QACb,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,MAAM;YAAG,OAAO;QAAG,GAAG;YAAE,QAAQ;QAAI;IACjE;AACF"}}]
}